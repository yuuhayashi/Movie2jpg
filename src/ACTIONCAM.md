# [タイムラプス動画ファイルから静止画を生成する](README.md)

## 中華アクションカムについて

「中華アクションカム」とは GoPro と類似する製品のこと、4000円弱(2018-05現在)で家電量販店などの特売で販売されている。
製品自体の種類が多く、１つの型番は２～３か月ほどで姿を消すが、型番は違うが中身はほぼ一緒のようです。
ここでは私が購入した「WiMiUS」という製品で説明します。


### 中華アクションカムの問題点

 * タイムラプス撮影を行うと0.5秒ピッチから設定できるが、生成されるのはH265形式の動画ファイルのみとなる。

 * インターバル撮影モードにするとJPEGファイルが一定間隔で生成されるが、設定できる時間が「最小３秒」と間隔が長すぎる。

 * インターバル撮影モードは撮影時のビープ音がうるさい。

Mapillaryにアップするなら１秒間隔にしたいので **タイムラプス撮影** に挑戦する必要がある。


## タイムラプスモード設定

 * 間隔は0.5秒  
    GPSロガーのロギング間隔を１秒間に設定するのでそれに合わせてタイムラプスも１秒間隔で十分に思えますが、切り出したJPEGに撮影時刻を割り当てる際に、GPSロガーの間隔とJPEG時刻の間隔にズレが生じます。そのズレを補正するために１秒より短い間隔で１／２秒に設定する。

 * 出力形式はMP4(h265)になってしまう  
    出力されるのはカメラの仕様上MP4(h265)になります。可能ならばMOV(mjpeg)形式ならベター

 * リアルタイム動画は？  
    タイムラプスではなくそのまま動画で撮影した場合は？ もちろんタイムラプスに比べて動画のファイルサイズは大きくなります。しかし、SDカードの容量がいっぱいになる前にバッテリーのほうが先になくなるのでファイルサイズはあまり問題になりません。  
リアルタイム動画ではコマ落ちの可能性が高くなるような気がします（個人の感想です）。JPEGに撮影時刻を割り当てる際に時間のズレが生じる可能性が高くなります。


## カメラ設定

`カメラの設定項目と推奨設定値`
  ```
設定モード
┃
┣━ ビデオ設定
┃　　┃
┃　　┣━ ビデオ解像度　[4K30FPS] <-- 任意
┃　　┣━ 録画音声 [OFF]
┃　　┣━ タイムラプス [OFF | 0.5s | 1s | 2s | 5s | 10s | 30s | 60s] <-- 1s
┃　　┣━ ループ録画 [OFF | 2分 | 3分 | 5分] <-- オフ
┃　　┗━ スローモーション [*]
┃
┣━ カメラ設定
┃　　┃
┃　　┣━ ピクセル　[2M | 5M | 8M | 12M | 16M ] <-- 任意（16M）
┃　　┣━ セルフタイマー　[*] <-- 任意
┃　　┣━ オート撮影　[OFF | 3S | 10S | 15S | 20S | 30S] <-- 任意
┃　　┗━ ドラマ？ショット [*]
┃
┣━ 撮影設定
┃　　┃
┃　　┣━ 露出　[-3 | -2 | -1 | 0 | 1 | 2 | 3] <-- 0
┃　　┣━ ホワイトバランス　[オート | 晴れ | 曇り | 白熱電球 | 蛍光灯] <-- オート
┃　　┣━ WiFi　[ON | OFF] <-- OFF
┃　　┣━ ローテーション　[ON | OFF] <-- OFF
┃　　┣━ 車載モード　[ON | OFF] <-- OFF　（ONにすると、電源をONにしただけで勝手に録画が始まってしまう）
┃　　┣━ 光周波数　[*] <-- オート
┃　　┣━ LEDインジケータランプ　[*] <-- 任意
┃　　┣━ 自動スクリーンセーバ　[*] <-- 任意 (30s)
┃　　┣━ 自動電源オフ　[*] <-- 任意 (オフ)
┃　　┗━ 時間ウォーターマーク　[ON | OFF] <-- **(ON)**
┃
┗━ その他の設定
　　　┃
　　　┣━ 言語　[*] <-- 日本語
　　　┣━ 日付・時間
　　　┣━ フォーマット
　　　┣━ 工場出荷状態に戻し
　　　┗━ ファームウェアバージョン
  ```

Mapillary用のタイムラプス動画の設定

 * 録画音声 [OFF]
 * タイムラプス  <-- 1s
 * ループ録画  <-- オフ
 * ローテーション　<-- OFF
 * 車載モード <-- OFF
 * 自動電源オフ　<-- オフ
 * 時間ウォーターマーク　<-- **(ON)**


### 動画ファイルのセット

撮影した動画ファイルを所定の場所に配置します。

```
/home/yuu/Desktop
┃
┗━ ./OSM
　　　┃
　　　┣━ ./OSM/img
　　　┃
　　　┗━ ./OSM/Movie
　　　　　　┃
　　　　　　┣━ Movie2jpg.ini
　　　　　　┣━ XXXX.mp4
　　　　　　┗━ YYYY.mp4

```

 * フォルダ `/home/yuu/Desktop/OSM/Movie` に MP4ファイルを配置する。

 * フォルダ `/home/yuu/Desktop/OSM/Movie` に `Movie2jpg.ini` を配置する。

[Movie2jpg.ini](/gitbucket/yuu/Movie2jpg/blob/master/Movie2jpg.ini) の設定例
```
[FFMPEG]
FFMPEG_OUTPUT_FRAME_RATE=30
```
  - 1.0秒間隔で撮影した場合はFFMPEG_OUTPUT_FRAME_RATE=30 (fps=30) とすると1.0間隔の静止画が取り出せる


